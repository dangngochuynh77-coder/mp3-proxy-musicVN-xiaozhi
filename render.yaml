services:
  # Dịch vụ 1: API Nhạc (Backend) - Dịch vụ Riêng tư
  - type: pvt  # <-- THAY ĐỔI QUAN TRỌNG: 'web' thành 'pvt'
    name: mp3-api
    env: node
    plan: free 
    autoDeploy: true
    rootDir: ./mp3-api
    buildCommand: npm install
    # App sẽ tự chạy trên port 5555 (vì code là || 5555)
    startCommand: npm start 
    # Không cần 'envVars' cho PORT nữa

  # Dịch vụ 2: Adapter cho Xiaozhi (Frontend/Proxy) - Dịch vụ Web
  - type: web # <-- Giữ nguyên là 'web' để có link public
    name: xiaozhi-adapter
    env: node
    plan: free 
    autoDeploy: true
    rootDir: ./adapter
    buildCommand: npm install
    startCommand: node xiaozhi-adapter.js
    envVars:
      - key: PORT
        value: 5005 # Cổng mà adapter sẽ lắng nghe
      - key: MP3_API_URL
        # Link này bây giờ sẽ hoạt động hoàn hảo
        value: http://mp3-api:5555
